import _0x4d534b from 'papaparse';
import * as _0xa59a45 from 'xlsx';

function parseCurriculum(_0x4780e2){let _0xcbd8c5='',_0x3952cc='',_0xa79ec2=0x0,_0x19893e=null;const _0x1b6d14=[];return _0x4d534b['parse'](_0x4780e2,{'skipEmptyLines':!![],'complete':_0x9a1262=>{_0x9a1262['data']['forEach'](_0x4c32f9=>{const _0xe9679b=_0x4c32f9['map'](_0x1ffd93=>(_0x1ffd93??'')['toString']()['trim']()),_0x3834df=_0xe9679b[0x0]??'';if(_0x3834df['includes']('Rev#')){const _0x2910a4=_0x3834df['match'](/([A-Z0-9]+)\s*-\s*.*:\s*(.*?)\s+Rev#\s*(\d+)/i);_0x2910a4&&(_0xcbd8c5=_0x2910a4[0x1]?.['trim']()??'',_0x3952cc=_0x2910a4[0x2]?.['trim']()??'',_0xa79ec2=parseInt(_0x2910a4[0x3]??'0',0xa));return;}if(/FIRST YEAR/i['test'](_0x3834df)){_0x19893e=0x1;return;}if(/SECOND YEAR/i['test'](_0x3834df)){_0x19893e=0x2;return;}if(/THIRD YEAR/i['test'](_0x3834df)){_0x19893e=0x3;return;}if(/FOURTH YEAR/i['test'](_0x3834df)){_0x19893e=0x4;return;}if(/FIFTH YEAR/i['test'](_0x3834df)){_0x19893e=0x5;return;}if(/First Semester/i['test'](_0x3834df)||/Second Semester/i['test'](_0x3834df)||/Summer/i['test'](_0x3834df))return;const _0x2d475d=[{'sem':0x1,'offset':0x0},{'sem':0x2,'offset':0x6},{'sem':0x3,'offset':0xc}];_0x2d475d['forEach'](({sem:_0x35e73f,offset:_0x5ba31b})=>{const _0x134359=_0xe9679b[_0x5ba31b]??'',_0x335b2d=_0xe9679b[_0x5ba31b+0x1]??'',_0x18d3aa=_0xe9679b[_0x5ba31b+0x2]??'',_0x29dbcd=_0xe9679b[_0x5ba31b+0x3]??'',_0x1ce368=_0xe9679b[_0x5ba31b+0x4]??'';_0x134359&&_0x19893e&&_0x1b6d14['push']({'curr_id':_0xcbd8c5,'program_name':_0x3952cc,'revision_no':_0xa79ec2,'year_level':_0x19893e,'sem':_0x35e73f,'course_id':_0x134359,'course_desc':_0x335b2d,'total_units':_0x18d3aa,'lec_unit':_0x29dbcd,'lab_unit':_0x1ce368});});});}}),_0x1b6d14;}

function convertToCSVFile(_0x47dfb4){return new Promise((_0xb14e07,_0x4c91ec)=>{const _0x88aab3=new FileReader();_0x88aab3['onload']=_0x48b4c3=>{const _0x59d588=_0x48b4c3['target']?.['result'];if(!_0x59d588){_0x4c91ec(new Error('Failed\x20to\x20read\x20file'));return;}try{const _0x3e59ff=_0xa59a45['read'](_0x59d588,{'type':'array'}),_0x23f804=_0x3e59ff['SheetNames'][0x0];if(!_0x23f804){_0x4c91ec(new Error('No\x20sheets\x20found\x20in\x20workbook'));return;}const _0x21e699=_0x3e59ff['Sheets'][_0x23f804];if(!_0x21e699){_0x4c91ec(new Error('No\x20sheets\x20found\x20in\x20worksheet'));return;}const _0x2de545=_0xa59a45['utils']['sheet_to_csv'](_0x21e699),_0x34d051=_0x47dfb4['name']['replace'](/\.[^/.]+$/,'.csv'),_0x557926=new File([_0x2de545],_0x34d051,{'type':'text/csv','lastModified':Date['now']()});_0xb14e07(_0x557926);}catch(_0x266d10){_0x4c91ec(_0x266d10);}},_0x88aab3['onerror']=()=>{_0x4c91ec(new Error('File\x20reading\x20failed'));},_0x88aab3['readAsArrayBuffer'](_0x47dfb4);});}

async function uploadCurriculum(_0x385e30,_0x2d5311){try{const _0x36d3c7=await convertToCSVFile(_0x2d5311),_0x133ec3=await _0x36d3c7['text'](),_0x114736=parseCurriculum(_0x133ec3),_0x3575bd=_0x4d534b['unparse'](_0x114736),_0x2c5054=new File([_0x3575bd],_0x36d3c7['name'],{'type':'text/csv'}),_0x255633=new FormData();_0x255633['append']('csvFile',_0x2c5054);const _0x4faf03=await fetch(_0x385e30+'/curr-courses/upload',{'method':'POST','body':_0x255633});if(!_0x4faf03['ok']){const _0x334d51=await _0x4faf03['json']();throw _0x334d51;}return _0x4faf03['json']();}catch(_0x57f342){throw _0x57f342;}}

function parseCourseOffering(_0x4602e7){let _0x3db22b='',_0x59109a='';const _0x348c8e=[],_0x1da5f1=_0x4d534b['parse'](_0x4602e7,{'header':![],'skipEmptyLines':!![],'delimiter':','}),_0x3edf05=_0x1da5f1['data'];for(let _0x460655=0x0;_0x460655<Math['min'](0x5,_0x3edf05['length']);_0x460655++){const _0x316ec2=_0x3edf05[_0x460655];if(_0x316ec2&&_0x316ec2['length']>0x0){const _0x1d4d85=_0x316ec2[0x0]?.['toString']()||'',_0xc0163e=_0x1d4d85['match'](/(First|Second)\s+Sem\s+S\/Y\s+(\d{4}-\d{4})/i);if(_0xc0163e){_0x3db22b=_0xc0163e[0x1]?.['toLowerCase']()==='first'?'1':'2';if(_0xc0163e[0x2]){const _0x131996=_0xc0163e[0x2]['match'](/(\d{2})(\d{2})-(\d{2})(\d{2})/);_0x131996&&_0x131996[0x2]&&_0x131996[0x4]&&(_0x59109a=_0x131996[0x2]+_0x131996[0x4]);}}}}let _0x11e1de=-1;for(let _0x178403=0x0;_0x178403<_0x3edf05['length'];_0x178403++){const _0x5560b6=_0x3edf05[_0x178403];if(_0x5560b6&&_0x5560b6['some'](_0x310662=>_0x310662?.['toString']()['toUpperCase']()['includes']('CODE'))){_0x11e1de=_0x178403;break;}}if(_0x11e1de===-1)throw new Error('Could\x20not\x20find\x20header\x20row\x20in\x20CSV\x20data');for(let _0x122279=_0x11e1de+0x1;_0x122279<_0x3edf05['length'];_0x122279++){const _0x2061dc=_0x3edf05[_0x122279];if(!_0x2061dc||_0x2061dc['length']<0x8)continue;const _0x25ffb=_0x2061dc[0x0]?.['toString']()['trim']()||'',_0x209718=_0x2061dc[0x1]?.['toString']()['trim']()||'',_0x5802ce=_0x2061dc[0x2]?.['toString']()['trim']()||'',_0x1b37ae=_0x2061dc[0x3]?.['toString']()['trim']()||'',_0x1f890a=_0x2061dc[0x4]?.['toString']()['trim']()||'',_0x14e5b9=_0x2061dc[0x5]?.['toString']()['trim']()||'',_0x24a8ab=_0x2061dc[0x6]?.['toString']()['trim']()||'',_0x2cbdc3=_0x2061dc[0x7]?.['toString']()['trim']()||'';if(!_0x25ffb)continue;let _0x126578=0x0;const _0x244d6f=_0x1b37ae['match'](/(\d+)/);_0x244d6f&&_0x244d6f[0x1]&&(_0x126578=parseInt(_0x244d6f[0x1],0xa));const _0x570c7c={'sem':_0x3db22b,'school_year':_0x59109a,'code':_0x25ffb,'course_no':_0x209718,'course_desc':_0x5802ce,'unit':_0x126578,'time':_0x1f890a,'days':_0x14e5b9,'faculty':_0x24a8ab,'room':_0x2cbdc3};_0x348c8e['push'](_0x570c7c);}return _0x348c8e;}

async function uploadCourseOffering(_0x13af28,_0x4a40ff){try{const _0x462899=await convertToCSVFile(_0x4a40ff),_0x8991cc=await _0x462899['text'](),_0x137573=parseCourseOffering(_0x8991cc),_0x1abcbb=_0x4d534b['unparse'](_0x137573),_0x18fd5d=new File([_0x1abcbb],_0x462899['name'],{'type':'text/csv'}),_0x138283=new FormData();_0x138283['append']('csvFile',_0x18fd5d);const _0x5c46b0=await fetch(_0x13af28+'/curr-courses/upload',{'method':'POST','body':_0x138283});if(!_0x5c46b0['ok']){const _0x23b0c7=await _0x5c46b0['json']();throw _0x23b0c7;}return _0x5c46b0['json']();}catch(_0x107d20){throw _0x107d20;}}

class Client{['BASE_URL'];constructor(_0x46050d){this['BASE_URL']=_0x46050d;}['Parser'](){return {'curriculum':async _0x412729=>{const _0x4093bd=await uploadCurriculum(this['BASE_URL'],_0x412729);return _0x4093bd;},'courseOffering':async _0x266d7b=>{const _0x18a613=await uploadCourseOffering(this['BASE_URL'],_0x266d7b);return _0x18a613;}};}}

export { Client as default };
